@{
    Layout = null;
}
<script>    
    $(document).ready(function () {
        $('#frm201gRMNO').text($('#HOUSE').combogrid('getValue'));
        $('#frm201gCNFNO').text($('#H2_CNFNO').val());
        var obj={};
        obj.TAGID = $.trim($('#CONTRAH_TAGID').val());
        var getGridJSON = '@Url.Action("getDG1", "Frm201g")';
        $('#frm201g1DG').datagrid({
            url: getGridJSON,
            queryParams: obj,
            border: true,
            rownumbers: false,
            nowrap: true,
            pagination: false,
            idField: 'EQUIPNO',
            striped: true,
            showHeader: true,
            fitColumns: false,
            remoteSort: false,
            singleSelect: true,
            columns: [[
                {field: 'EQUIPNO', title: '編號', sortable: true, width: 50, halign: "center", align: "center",sortable: true},
                {field: 'CNM', title: '設備名稱',sortable: true, width: 110, halign: "center", align: "left", sortable: true},
                {field: 'MAKR',title: '廠牌', sortable: true, width: 80,halign: "center",align: "left", sortable: true},
                {field: 'SPEC',title: '規格', sortable: true, width: 90,halign: "center",align: "left", sortable: true},
                {field: 'QTY',title: '數量', sortable: true, width: 50,halign: "center",align: "center", sortable: true}
            ]]
        });

        var getGridJSON2 = '@Url.Action("getDG2", "Frm201g")';
        $('#frm201g2DG').datagrid({
            url: getGridJSON2,
            queryParams: obj,
            border: true,
            rownumbers: false,
            nowrap: true,            
            pagination: false,
            idField: 'CNO',
            striped: true,
            showHeader: true,
            fitColumns: false,
            remoteSort: false,
            singleSelect: true,
            columns: [[
                {field: 'CNO', title: '編號', sortable: true, width: 50, halign: "center", align: "center",sortable: true},
                {field: 'CNM', title: '設備名稱',sortable: true, width: 110, halign: "center", align: "left", sortable: true},
                {field: 'MAKR',title: '廠牌', sortable: true, width: 80,halign: "center",align: "left", sortable: true},
                {field: 'SPEC',title: '規格', sortable: true, width: 90,halign: "center",align: "left", sortable: true}                
            ]]
        });


    });   //ready end



    function doRemoveDg() {
        var row = $('#frm201g1DG').datagrid('getSelected');

        if(row!=null){
            $.messager.confirm('執行確認', '您確定要新增?', function (r) {
                if (r) {
                    var obj = {};
                    obj.TAGID = row.TAGID;
                    obj.JOBTAG = $.trim($('#CONTRAH_TAGID').val());
                    $.ajax({
                        url: '@Url.Action("doRemove", "Frm201g")',
                        data: obj,
                        type: "post",
                        dataType: "json",
                        success: function (data, textStatus, jqXHR) {
                            $('#frm201g1DG').datagrid('reload');
                            $.messager.alert('系統訊息', '資料已儲存!', 'info');
                        },
                        beforeSend: function (xhr, settings) {
                            settings.data =
                               settings.data.replace(/%5D%5B(.+?)%5D=/g, "%5D.$1=");
                        }
                    });
                }
            });
        } else {
            $.messager.alert('系統訊息', '尚未選取資料!', 'warning');
        }
         
    }

    function doAddDg() {
        var row = $('#frm201g2DG').datagrid('getSelected');
        if(row!=null){
            $.messager.confirm('執行確認', '您確定要新增?', function (r) {
                if (r) {                        
                    var obj = {};
                    obj.RMNO = $('#HOUSE').combogrid('getValue');
                    obj.JOBTAG = $.trim($('#CONTRAH_TAGID').val());
                    obj.EQUIPNO = row.CNO;
                    obj.QTY = $('#frm201gQTY').numberspinner('getValue');
                    obj.CNHNO = $('#CNHNO').val();                        

                    $.ajax({
                        url: '@Url.Action("doAdd", "Frm201g")',
                        data: obj,
                        type: "post",
                        dataType: "json",
                        success: function (data, textStatus, jqXHR) {
                            $('#frm201g1DG').datagrid('reload');               
                            $.messager.alert('系統訊息', '資料已儲存!', 'info');
                        },
                        beforeSend: function (xhr, settings) {
                            settings.data =
                               settings.data.replace(/%5D%5B(.+?)%5D=/g, "%5D.$1=");
                        }
                    });
                }
              });
            }else{
            $.messager.alert('系統訊息', '尚未選取資料!', 'warning');
        }
    }

</script>

房號: <span id="frm201gRMNO"></span> 合約編號: <span id="frm201gCNFNO"></span>
<table width="820" height="500" border="1">
    <tr>
        <td width="400" height="580" valign="top">
            合約內傢俱
            <table id="frm201g1DG" data-options="modal:true" style="width:390px;height:480px"></table>
        </td>
        <td width="46">
            <a href="#" class="easyui-linkbutton c7" style="width:80px" onclick="doRemoveDg()">移除 ></a>
            <br /><br />
            <a href="#" class="easyui-linkbutton c7" style="width:80px" onclick="doAddDg()">< 新增 </a>
        </td>
        <td width="372" valign="top">
            數量調整 <input id="frm201gQTY" name="frm201gQTY" class="easyui-numberspinner" style="width:80px;" data-options="min:1,max:100,editable: false" value="1"></input>
            <table id="frm201g2DG" data-options="modal:true" style="width:350px;height:480px"></table>
        </td>
    </tr>
</table>