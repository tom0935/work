@{
    ViewBag.Title = "Frm305 年度住房率預估作業";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<script type="text/javascript" src="~/Content/js/util/datetime/DateTimeUtil.js"></script>
<script type="text/javascript" src="~/Content/easyui/exts/validatebox-ext.js"></script>
<script>
    $(document).ready(function () {

        f305DG1init();



    });   //ready end

    $(window).load(function () {


        //  $('#NOWDT').datebox('setValue', nowDate);


        


    });



    function f305DG1init() {

        $('#f305DG1').datagrid({
            url: '@Url.Action("getDG1", "Frm305")',
            width: '150',
            height: '500',
            rownumbers: true,
            nowrap: true,
            pagination: false,
            idField: 'TAGID',
            striped: true,
            showHeader: true,
            fitColumns: false,
            remoteSort: false,
            singleSelect: true,
            columns: [[
                { field: 'YRN', title: '已估年度', sortable: true, width: 100, halign: "center", align: "center", sortable: true }                                
            ]],
            onSelect: function (rowIndex, row) {
                initf305FORM(row);
            }
        });
    }






    function initf305FORM(row) {
        // $('#f305OTHERN').combobox('setText', $.trim(row.OTHERN));        
        $('#M01').val($.trim(row.M01));
        $('#M02').val($.trim(row.M02));
        $('#M03').val($.trim(row.M03));
        $('#M04').val($.trim(row.M04));
        $('#M05').val($.trim(row.M05));
        $('#M06').val($.trim(row.M06));
        $('#M07').val($.trim(row.M07));
        $('#M08').val($.trim(row.M08));
        $('#M09').val($.trim(row.M09));
        $('#M10').val($.trim(row.M10));
        $('#M11').val($.trim(row.M11));
        $('#M12').val($.trim(row.M12));
        $('#f305TAGID').val($.trim(row.TAGID));
        $('#f305YRN').combobox('setValue', row.YRN);

    }

    function doAdd() {
        if (doCheck()) {
            $.messager.confirm('執行確認', "確認要新增資料?", function (r) {
                if (r) {
                    var obj = getObj();
                    obj.TAGID = null;
                    $.ajax({
                        url: '@Url.Action("doAdd", "Frm305")',
                        type: "post",
                        data: getObj(),
                        dataType: "json",
                        success: function (data, textStatus, jqXHR) {
                            if (data.status != '0') {                                
                                $.messager.alert('系統訊息', '資料已新增!', 'info');
                            }
                        }
                    });
                }
            });
        }
    }







    function doSave() {
        if (doCheck()) {
            $.messager.confirm('執行確認', "確認儲存?", function (r) {
                if (r) {
                    var obj = getObj();
                    
                    $.ajax({
                        url: '@Url.Action("doSave", "Frm305")',
                        type: "post",
                        data: obj,
                        dataType: "json",
                        success: function (data, textStatus, jqXHR) {
                            if (data.status != '0') {                                
                                $.messager.alert('系統訊息', '資料已儲存!', 'info');
                            }
                        }
                    });
                }
            });
        }
    }

    function getObj() {
        var obj = {};
        obj.M01 = $('#M01').val();
        obj.M02 = $('#M02').val();
        obj.M03 = $('#M03').val();
        obj.M04 = $('#M04').val();
        obj.M05 = $('#M05').val();
        obj.M06 = $('#M06').val();
        obj.M07 = $('#M07').val();
        obj.M08 = $('#M08').val();
        obj.M09 = $('#M09').val();
        obj.M10 = $('#M10').val();
        obj.M11 = $('#M11').val();
        obj.M12 = $('#M12').val();
        obj.YRN = $('#f305YRN').combobox('getValue');
        obj.TAGID = $('#f305TAGID').val();
        return obj;
    }


    function doClear() {
        $('#f305FEEDT').datebox('setValue', '');
        $('#f305AMTSUM').val('');
        $('#f305NOTES').val('');        
        $('#f305LOGUSR').combobox('setValue','' );
        $('#f305TAGID').val('');
    }


    //刪除
    function doRemove() {
        var row = $('#f305DG1').datagrid('getSelected');
        if (row != null) {
            $.messager.confirm('執行確認', '確定要刪除資料?', function (r) {
                if (r) {
                    var obj = {};
                    obj.TAGID = $.trim(row.TAGID);
                    $.ajax({
                        url: '@Url.Action("doRemove", "Frm305")',
                        type: "post",
                        data: obj,
                        dataType: "json",
                        success: function (data, textStatus, jqXHR) {
                            if (data.status != '0') {
                                $('#f305DG1').datagrid('reload');
                                doClear();
                                $.messager.alert('系統訊息', '選取資料已刪除!', 'info');
                            }
                        }
                    });
                }
            });
        } else {
            $.messager.alert('系統訊息', '尚未選取資料!', 'warning');
        }
    }


    function doCheck() {
        var pass = false;
        if ($('#M01').val() == "" ) {
            $.messager.alert('系統訊息', '尚未輸入一月份住房率!', 'warning');
        } else if ($('#M02').val() == "") {
            $.messager.alert('系統訊息', '尚未輸入二月份住房率!', 'warning');
        } else if ($('#M03').val() == "") {
            $.messager.alert('系統訊息', '尚未輸入三月份住房率!', 'warning');
        } else if ($('#M04').val() == "") {
            $.messager.alert('系統訊息', '尚未輸入四月份住房率!', 'warning');
        } else if ($('#M05').val() == "") {
            $.messager.alert('系統訊息', '尚未輸入五月份住房率!', 'warning');
        } else if ($('#M06').val() == "") {
            $.messager.alert('系統訊息', '尚未輸入六月份住房率!', 'warning');
        } else if ($('#M07').val() == "") {
            $.messager.alert('系統訊息', '尚未輸入七月份住房率!', 'warning');
        } else if ($('#M08').val() == "") {
            $.messager.alert('系統訊息', '尚未輸入八月份住房率!', 'warning');
        } else if ($('#M09').val() == "") {
            $.messager.alert('系統訊息', '尚未輸入九月份住房率!', 'warning');
        } else if ($('#M10').val() == "") {
            $.messager.alert('系統訊息', '尚未輸入十月份住房率!', 'warning');
        } else if ($('#M11').val() == "") {
            $.messager.alert('系統訊息', '尚未輸入十一月份住房率!', 'warning');
        } else if ($('#M12').val() == "") {
            $.messager.alert('系統訊息', '尚未輸入十二月份住房率!', 'warning');
        }else{
            pass = true;
        }
        return pass;
    }






</script>
<h2>Frm305 年度住房率預估作業</h2>
<input type="hidden" id="f305TAGID" name="f305TAGID" />
<a id="btnCAdd" href="#" class="easyui-linkbutton" data-options="iconCls:'add-icon'" onclick="doAdd()">新增</a>
<a id="btnCSave" href="#" class="easyui-linkbutton" data-options="iconCls:'save-icon'" onclick="doSave()">存檔</a>
<br />
<br />

<table width="540" border="1">
    <tr>
        <td width="300" height="436" valign="top">
            預估年度
            <label>
                <select id="f305YRN" class="easyui-combobox" name="f305YRN" style="width:90px;height:28px">
                    <option>2005</option>
                    <option>2006</option>
                    <option>2007</option>
                    <option>2008</option>
                    <option>2009</option>
                    <option>2010</option>
                    <option>2012</option>
                    <option>2013</option>
                    <option>2014</option>
                    <option>2015</option>
                    <option>2016</option>
                    <option>2017</option>
                    <option>2018</option>
                    <option>2020</option>
                    <option>2021</option>
                    <option>2022</option>
                    <option>2023</option>
                    <option>2024</option>
                    <option>2025</option>
                    <option>2026</option>
                    <option>2027</option>
                    <option>2028</option>
                    <option>2029</option>
                    <option>2030</option>
                </select>
                <br>
                住房率<br>
                一月
                <input type="text" name="M01" id="M01" style="width:80px" value="0.0">
                %<br>
                二月
                <input type="text" name="M02" id="M02" style="width:80px" value="0.0">
                %<br>
                三月
                <input type="text" name="M03" id="M03" style="width:80px" value="0.0">
                %<br>
                四月
                <input type="text" name="M04" id="M04" style="width:80px" value="0.0">
                %<br>
                五月
                <input type="text" name="M05" id="M05" style="width:80px" value="0.0">
                %<br>
                六月
                <input type="text" name="M06" id="M06" style="width:80px" value="0.0">
                %<br>
                七月
                <input type="text" name="M07" id="M07" style="width:80px" value="0.0">
                %<br>
                八月
                <input type="text" name="M08" id="M08" style="width:80px" value="0.0">
                %<br>
                九月
                <input type="text" name="M09" id="M09" style="width:80px" value="0.0">
                %<br>
                十月
                <input type="text" name="M10" id="M10" style="width:80px" value="0.0">
                %<br>
                十一月
                <input type="text" name="M11" id="M11" style="width:80px" value="0.0">
                %<br>
                十二月
                <input type="text" name="M12" id="M12" style="width:80px" value="0.0">
                %
            </label>
        </td>
        <td width="200" valign="top">  
            <table id="f305DG1"></table>
        </td>
    </tr>
</table>
