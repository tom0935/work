@{
    ViewBag.Title = "Frm105 設備資料維護";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<script type="text/javascript">
    $(document).ready(function () {        
        Initialize_DataGrid();
        initDataGrid2(null);
    });

    function Initialize_DataGrid() {
        var getGridJSON = '@Url.Action("Grid", "Frm105")';
        $('#DataGrid').datagrid({
            title: '設備資料維護',
            url: getGridJSON,
            width: '650',
            height: '400',
            rownumbers: true,
            nowrap: true,
            pagination: false,
            idField: 'CNO',
            striped: true,
            showHeader: true,
            fitColumns: true,
            remoteSort: true,
            singleSelect: true,
            sortName: 'CNO',
            sortOrder: 'asc',
            columns: [[
                {
                    field: 'CNO',
                    title: '設備編號',
                    sortable: true,
                    width: 50,
                    halign: "center",
                    align: "center",
                    sortable: true,                    
                },
                {
                    field: 'CNM',
                    title: '設備名稱',
                    sortable: true,
                    width: 120,
                    halign: "center",
                    align: "left",
                    sortable: true
                },
                {
                    field: 'MAKR',
                    title: '製造商',
                    sortable: true,
                    width: 120,
                    halign: "center",
                    align: "left",
                    sortable: true
                },
                {
                    field: 'SPEC',
                    title: '規格',
                    sortable: true,
                    width: 120,
                    halign: "center",
                    align: "left",
                    sortable: true
                },
                {
                    field: 'KIND',
                    title: '設備分類',
                    sortable: true,
                    width: 120,
                    halign: "center",
                    align: "left",
                    sortable: true
                },
                {
                    field: 'ASET',
                    title: '新光資產項',
                    sortable: true,
                    width: 120,
                    halign: "center",
                    align: "left",
                    sortable: true
                }
            ]],
            onSelect: function (rowIndex, rowData) {
                $('#CNO').val($.trim(rowData.CNO));
                $('#CNM').val($.trim(rowData.CNM));
                $('#MAKR').val($.trim(rowData.MAKR));
                $('#SPEC').val($.trim(rowData.SPEC));
                $('#KIND').combobox('setValue', $.trim(rowData.KIND));
                $('#ASET').val($.trim(rowData.ASET));
                if (rowData.ASET == 'Y') {
                    $('input:radio[name=ASET]').get(0).checked = true;
                } else {
                    $('input:radio[name=ASET]').get(1).checked = true;
                }
                initDataGrid2(rowData.CNO);
            }
        });

    }

    function initDataGrid2(cno) {
        var obj = {};
        obj.CNO = cno;
        $('#DataGrid2').datagrid({
            url: '@Url.Action("Grid2", "Frm105")',
            showHeader: true,
            queryParams: obj,
            singleSelect: true,
            width: '250',
            height: '300',
            showFooter: true,
            columns: [[
                {
                    field: 'RMNO',
                    title: '房號',
                    width: 100,
                    halign: "center",
                    align: "center"
                },
                {
                    field: 'QTY',
                    title: '數量',
                    width: 100,
                    halign: "center",
                    align: "center"
                }
            ]]
        });
    }

    //新增
    function doAdd() {
        doClear();
        if ($('#mode').val() == 'save') {
            $('#btnAdd').linkbutton({ text: '取消新增' });
            $('#mode').val('add');
            $('#CNO').attr('readonly', false);
        } else {
            $('#btnAdd').linkbutton({ text: '新增' });
            $('#mode').val('save');
            $('#CNO').attr('readonly', true);
        }
    }

    //儲存
    function doSave() {
        
        var mode = $.trim($('#mode').val());
        var bResult = $('#editForm').form('validate');
        if (bResult) {
            $.ajax({
                url: '@Url.Action("Save", "Frm105")',
                type: "post",
                data: getObj(mode),
                dataType: "json",
                success: function (data, textStatus, jqXHR) {
                    if (data.status != '0') {
                        $('#btnAdd').linkbutton('enable');
                        $('#DataGrid').datagrid('reload');
                        $.messager.alert('系統訊息', '資料已儲存!', 'info');
                    } else {
                        $.messager.alert('系統訊息', data.message, 'error');
                    }
                    $('#mode').val('save');
                    $('#btnAdd').linkbutton({ text: '新增' });
                }
            });
        }
    }
    function doRemove() {
        var selectRow = $('#DataGrid').datagrid('getSelected');
        
        if (selectRow != null) {
            var obj = {};
            obj.CNO = selectRow.CNO;
            $.messager.confirm('執行確認', '是否確認刪除設備編號:' + obj.CNO + ' 此筆資料?', function (r) {
                if (r) {
                    $.ajax({
                        url: '@Url.Action("Remove", "Frm105")',
                        type: "post",
                        data: obj,
                        dataType: "json",
                        success: function (data, textStatus, jqXHR) {
                            if (data.status != '0') {
                                $.messager.alert('系統訊息', '資料已刪除!', 'info');
                                doClear();
                                $('#DataGrid').datagrid('reload');
                            } else {
                                $.messager.alert('系統訊息', data.message, 'error');
                            }

                        }
                    });
                }
            });
        } else {
            $.messager.alert('系統訊息', '您尚未選取資料', 'warning');
        }
    }

    function doClear() {
        $('#CNO').val('');
        $('#CNM').val('');
        $('#MAKR').val('');
        $('#SPEC').val('');
    }

    function getObj(mode) {
        var obj = {};
        obj.CNO = $.trim($('#CNO').val());
        obj.CNM = $.trim($('#CNM').val());
        obj.MAKR = $.trim($('#MAKR').val());
        obj.SPEC = $.trim($('#SPEC').val());
        obj.KIND = $.trim($('#KIND').combobox('getValue'));
        obj.ASET = $("input[name='ASET']:checked").val();
        obj.mode = mode;
        return obj;
    }
</script>
<h2>Frm105 設備資料維護</h2>
<a id="btnReload" href="#" class="easyui-linkbutton" data-options="iconCls:'icon-reload'" onclick="Initialize_DataGrid()">重新顯示</a>
<a id="btnAdd" href="#" class="easyui-linkbutton" data-options="iconCls:'add-icon'" onclick="doAdd()">新增</a>
<a id="btnSave" href="#" class="easyui-linkbutton" data-options="iconCls:'save-icon'" onclick="doSave()">儲存</a>
<a id="btnRemove" href="#" class="easyui-linkbutton" data-options="iconCls:'icon-no'" onclick="doRemove()">刪除</a>



<table width="900" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td width="600">
            <strong>設備維護</strong><br />
            <form id="editForm" name="editForm" method="post">
                <input type="hidden" id="mode" name="mode" value="save" />
                <table width="600" border="0" cellpadding="2" cellspacing="0">
                    <tr>
                        <td width="130">設備編號</td>
                        <td align="left"><input type="text" name="CNO" id="CNO" class="easyui-validatebox" style="width:80px" size="5" data-options="required:true" readonly="readonly" /></td>
                        <td width="130">規格</td>
                        <td align="left"><input type="text" name="SPEC" id="SPEC" class="easyui-validatebox" style="width:150px" /></td>
                    </tr>
                    <tr>
                        <td>設備名稱</td>
                        <td><input type="text" name="CNM" id="CNM" class="easyui-validatebox" style="width:150px" /></td>
                        <td>設備分類</td>
                        <td>
                            <select id="KIND" name="KIND" class="easyui-combobox" data-options="editable:false" style="width:150px;">
                                <option value=""></option>
                                <option value="標準">標準</option>
                                <option value="請購">請購</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>製造商</td>
                        <td><input type="text" name="MAKR" id="MAKR" class="easyui-validatebox" style="width:150px" /></td>
                        <td>新光資產項</td>
                        <td align="left">                           
                             <input name="ASET" type="radio" value="Y" /> 是 
                             <input name="ASET" type="radio" value="" /> 否 
                        </td>
                    </tr>
                </table>
            </form>
        </td>
        <td rowspan="2" valign="top" width="300">
         <br/><br /><br /><br /><br /><br /><br /><br />
    <strong>設備分佈</strong><br />
    <table id="DataGrid2"></table>
</td>
    </tr>
    <tr>
        <td valign="top"><table id="DataGrid"></table></td>
    </tr>
</table>




