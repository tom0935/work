@{
    ViewBag.Title = "Frm114 廠商資料維護";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<script type="text/javascript" src="~/Content/easyui/exts/datagrid-filter.js"></script>
<!--
/* 
廠商編號 CNO 
廠商名稱 CNM
SDEP
行業別 RUNTP
CPID
CPMGR
CPADR
TEL
FAX
EMAIL
 */    
-->
<script type="text/javascript">
     $(document).ready(function () {
         Initialize_DataGrid();
       //  initDataGrid2(null);
     });

     function Initialize_DataGrid() {
         var getGridJSON = '@Url.Action("Grid", "Frm114")';
        $('#DataGrid').datagrid({
            title: '廠商資料維護',
            url: getGridJSON,
            width: '650',
            height: '400',
            rownumbers: true,
            nowrap: true,
            pagination: false,
            pageSize: 20,
            idField: 'CNO',
            striped: true,
            showHeader: true,
            fitColumns: true,
            remoteSort: true,
            singleSelect: true,
            sortName: 'CNO',
            sortOrder: 'asc',
            columns: [[
                {
                    field: 'CNO',
                    title: '廠商編號',
                    sortable: true,
                    width: 50,
                    halign: "center",
                    align: "center",
                    sortable: true
                },               
                {
                    field: 'CNM',
                    title: '廠商名稱',
                    sortable: true,
                    width: 150,
                    halign: "center",
                    align: "left",
                    sortable: true
                }
            ]],
            onSelect: function (rowIndex, rowData) {


                $('#CNO').val($.trim(rowData.CNO));
                $('#CNM').val(rowData.CNM);
                $('#SDEP').val(rowData.SDEP);
                
                $('#RUNTP').val(rowData.RUNTP);
                $('#CPADR').val($.trim(rowData.CPADR));                
                $('#CPMGR').val($.trim(rowData.CPMGR));
                $('#CPID').val($.trim(rowData.CPID));
                $('#TEL').val($.trim(rowData.TEL));
                $('#FAX').val($.trim(rowData.FAX));                
                $('#EMAIL').val($.trim(rowData.EMAIL));

                $('#TAGID').val('');
                $('#dMAN').val('');
                $('#dTEL').val('');
                $('#dNOTES').val('');
                
                initDataGrid2(rowData.CNO);
            }
        });

        $(function () {
            var dg = $('#DataGrid').datagrid();
            dg.datagrid('enableFilter', [{
                field: 'AA',
                type: 'textbox',
                //options: { precision: 1 },
                op: ['equal', 'notequal', 'less', 'greater']
            }]);
        });

    }


    function initDataGrid2(cno) {
        var obj = {};
        obj.CNO = cno;
        $('#DataGrid2').datagrid({
            url: '@Url.Action("Grid2", "Frm114")',
            showHeader: true,
            queryParams: obj,
            singleSelect: true,
            width: '310',
            height: '250',
            columns: [[
                {
                    field: 'MAN',
                    title: '姓名',                    
                    width: 150,
                    halign: "center",
                    align: "center"
                },
                {
                    field: 'TEL',
                    title: '電話',
                    width: 150,
                    halign: "center",
                    align: "left"
                }
            ]],
            onSelect: function (rowIndex, row) {                
                $('#TAGID').val($.trim(row.TAGID));
                $('#dMAN').val($.trim(row.MAN));
                $('#dTEL').val($.trim(row.TEL));
                $('#dEMAIL').val($.trim(row.EMAIL));
                $('#dNOTES').val($.trim(row.NOTES));

            }
        });
    }


    //新增											
    function doAdd() {
        doClear();
        if ($('#mode').val() == 'save') {
            $('#btnAdd').linkbutton({ text: '取消新增' });
            $('#mode').val('add');
            $('#CNO').attr('readonly', false);
        } else {
            $('#btnAdd').linkbutton({ text: '新增' });
            $('#mode').val('save');
            $('#CNO').attr('readonly', true);
        }
    }

    //儲存
    function doSave() {
        
        var mode = $.trim($('#mode').val());

        var bResult = $('#editForm').form('validate');
        if (bResult) {
            $.ajax({
                url: '@Url.Action("Save", "Frm114")',
                type: "post",
                data: getObj(mode),
                dataType: "json",
                success: function (data, textStatus, jqXHR) {
                    if (data.status != '0') {
                        $('#btnAdd').linkbutton('enable');
                        $('#DataGrid').datagrid('reload');
                        $.messager.alert('系統訊息', '資料已儲存!', 'info');
                    } else {
                        $.messager.alert('系統訊息', data.message, 'error');
                    }
                    $('#mode').val('save');
                    $('#btnAdd').linkbutton({ text: '新增' });
                }
            });
        }
    }
    function doRemove() {
        var selectRow = $('#DataGrid').datagrid('getSelected');        
        if (selectRow != null) {
            var obj = {};
            obj.CNO = selectRow.CNO;
            $.messager.confirm('執行確認', '是否確認刪除廠商編號:' + obj.CNO + ' 此筆資料?', function (r) {
                if (r) {
                    $.ajax({
                        url: '@Url.Action("Remove", "Frm114")',
                        type: "post",
                        data: obj,
                        dataType: "json",
                        success: function (data, textStatus, jqXHR) {
                            if (data.status != '0') {
                                $.messager.alert('系統訊息', '資料已刪除!', 'info');
                                doClear();
                                $('#DataGrid').datagrid('reload');
                            } else {
                                $.messager.alert('系統訊息', data.message, 'error');
                            }

                        }
                    });
                }
            });
        } else {
            $.messager.alert('系統訊息', '您尚未選取資料', 'warning');
        }


    }

    function doClear() {
        $('#CNO').val('');
        $('#CNM').val('');
        $('#CNTACT').val('');
        $('#TEL').val('');
        $('#FAX').val('');
        $('#MTEL').val('');
    }

    function getObj(mode) {
        var obj = {};
        obj.CNO = $.trim($('#CNO').val());
        obj.CNM = $.trim($('#CNM').val());
        obj.CNTACT = $.trim($('#CNTACT').val());
        obj.TEL = $.trim($('#TEL').val());
        obj.FAX = $.trim($('#FAX').val());
        obj.MTEL = $.trim($('#MTEL').val());

        obj.SDEP = $.trim($('#SDEP').val());
        obj.CPMGR = $.trim($('#CPMGR').val());
        obj.RUNTP = $.trim($('#RUNTP').val());
        obj.CPID = $.trim($('#CPID').val());
        obj.CPADR = $.trim($('#CPADR').val());
        obj.EMAIL = $.trim($('#EMAIL').val());
        obj.mode = mode;
        return obj;
    }

    

    //新增											
    function doAdd2() {
        doClear2();
        if ($('#mode2').val() == 'save') {
            $('#btnAdd2').linkbutton({ text: '取消新增' });
            $('#mode2').val('add');        
        } else {
            $('#btnAdd2').linkbutton({ text: '新增' });
            $('#mode2').val('save');        
        }
    }

    //儲存
    function doSave2() {
        
        var mode = $.trim($('#mode2').val());
        var bResult = $.trim($('#dMAN').val());
        if (bResult!='') {
            $.ajax({
                url: '@Url.Action("Save2", "Frm114")',
                type: "post",
                data: getObj2(mode),
                dataType: "json",
                success: function (data, textStatus, jqXHR) {
                    if (data.status != '0') {
                        $('#btnAdd2').linkbutton('enable');
                        $('#DataGrid2').datagrid('reload');
                        $.messager.alert('系統訊息', '資料已儲存!', 'info');
                    } else {
                        $.messager.alert('系統訊息', data.message, 'error');
                    }
                    $('#mode2').val('save');
                    $('#btnAdd2').linkbutton({ text: '新增' });
                }
            });
        } else {
            $.messager.alert('系統訊息', '連絡人不可空白!', 'error');
        }
    }
    //連絡人
    function doRemove2() {
        var selectRow = $('#DataGrid2').datagrid('getSelected');
        
    if (selectRow != null) {

        var obj = {};
        obj.TAGID = selectRow.TAGID;
     
        $.messager.confirm('執行確認', '是否確認刪除連絡人:' + selectRow.MAN + ' 此筆資料?', function (r) {
            if (r) {
                $.ajax({
                    url: '@Url.Action("Remove2", "Frm114")',
                    type: "post",
                    data: obj,
                    dataType: "json",
                    success: function (data, textStatus, jqXHR) {
                        if (data.status != '0') {
                            $.messager.alert('系統訊息', '資料已刪除!', 'info');
                            doClear2();
                            $('#DataGrid2').datagrid('reload');
                        } else {
                            $.messager.alert('系統訊息', data.message, 'error');
                        }

                    }
                });
            }
        });
     } else {
        $.messager.alert('系統訊息', '您尚未選取資料', 'warning');
     }
   }

    function doClear2() {
        $('#dMAN').val('');
        $('#dTEL').val('');
        $('#dEMAIL').val('');
        $('#dNOTES').val('');
        $('#TAGID').val('');
    }

    function getObj2(mode) {
        var obj = {};
        obj.MAN = $.trim($('#dMAN').val());
        obj.TEL = $.trim($('#dTEL').val());
        obj.EMAIL = $.trim($('#dEMAIL').val());
        obj.NOTES = $.trim($('#dNOTES').val());
        obj.TAGID = $.trim($('#TAGID').val());
        obj.MAKRNO = $.trim($('#CNO').val());
        obj.mode = mode;
        return obj;
    }


</script>
<h2>Frm114 廠商資料維護</h2>
<a id="btnReload" href="#" class="easyui-linkbutton" data-options="iconCls:'icon-reload'" onclick="Initialize_DataGrid()">重新顯示</a>
<a id="btnAdd" href="#" class="easyui-linkbutton" data-options="iconCls:'add-icon'" onclick="doAdd()">新增</a>
<a id="btnSave" href="#" class="easyui-linkbutton" data-options="iconCls:'save-icon'" onclick="doSave()">儲存</a>
<a id="btnRemove" href="#" class="easyui-linkbutton" data-options="iconCls:'icon-no'" onclick="doRemove()">刪除</a>
 
 <table width="1100" height="279" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td height="193" colspan="2">
            <form id="editForm" name="editForm" method="post">
                <input type="hidden" id="mode" name="mode" value="save" />
                <table width="100%" border="0" cellpadding="2" cellspacing="0">
                    <tr>
                        <td width="138">廠商編號</td>
                        <td width="239" align="left"><input type="text" name="CNO" id="CNO" class="easyui-validatebox" style="width:80px" size="5" data-options="required:true" readonly="readonly" /></td>
                        <td width="112">統一編號</td>
                        <td colspan="3" align="left"><input type="text" name="CPID" id="CPID" class="easyui-validatebox" style="width:150px" /></td>
                    </tr>
                    <tr>
                        <td>廠商名稱</td>
                        <td><input type="text" name="CNM" id="CNM" class="easyui-validatebox" style="width:150px" /></td>
                        <td>公司地址</td>
                        <td colspan="3"><input type="text" name="CPADR" id="CPADR" class="easyui-validatebox" style="width:450px" /></td>
                    </tr>
                    <tr>
                        <td>服務部門</td>
                        <td><input type="text" name="SDEP" id="SDEP" class="easyui-validatebox" style="width:150px" /></td>
                        <td>負責人</td>
                        <td colspan="3"><input type="text" name="CPMGR" id="CPMGR" class="easyui-validatebox" style="width:150px" /></td>
                    </tr>
                    <tr>
                        <td>工作性質</td>
                        <td><input type="text" name="RUNTP" id="RUNTP" class="easyui-validatebox" style="width:150px" /></td>
                        <td>電話</td>
                        <td width="298"><input type="text" name="TEL" id="TEL" class="easyui-validatebox" style="width:150px" /></td>
                        <td width="84">傳真</td>
                        <td width="205"><input type="text" name="FAX" id="FAX" class="easyui-validatebox" style="width:150px" /></td>
                    </tr>
                    <tr>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>電子信箱</td>
                        <td colspan="3"><input type="text" name="EMAIL" id="EMAIL" class="easyui-validatebox" style="width:300px" /></td>
                    </tr>
                </table>
            </form>
        </td>
    </tr>
    <tr>
        <td width="550" valign="top"><table id="DataGrid"></table></td>
        <td width="550" valign="top">
            <input type="hidden" id="mode2" name="mode2" value="save" />
            <input type="hidden" id="TAGID" name="TAGID" value="" />
            <strong>聯絡人</strong> <a id="btnAdd2" href="#" class="easyui-linkbutton" data-options="iconCls:'add-icon'" onclick="doAdd2()">新增</a> <a id="btnSave2" href="#" class="easyui-linkbutton" data-options="iconCls:'save-icon'" onclick="doSave2()">儲存</a> <a id="btnRemove2" href="#" class="easyui-linkbutton" data-options="iconCls:'icon-no'" onclick="doRemove2()">刪除</a><br />
            姓名<input type="text" name="dMAN" id="dMAN" class="easyui-validatebox" style="width:150px" />
            電話 <input type="text" name="dTEL" id="dTEL" class="easyui-validatebox" style="width:150px" />
            <br>
            EMAIL <input type="text" name="dEMAIL" id="dEMAIL" class="easyui-validatebox" style="width:300px" />
            <br>
            備註<input type="text" name="dNOTES" id="dNOTES" class="easyui-validatebox" style="width:300px" />
            <table id="DataGrid2"></table>
        </td>
    </tr>
</table>

    
