@{
    ViewBag.Title = "Frm115 費用科目維護";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script type="text/javascript" src="~/Content/js/util/EasyuiUtil.js"></script>
<script type="text/javascript" src="~/Content/js/util/StrUtil.js"></script>

<script type="text/javascript">
     $(document).ready(function () {
         
         Initialize_DataGrid();

         $('#ROLEID').combogrid
         ({
             url: '@Url.Action("Combobox", "Frm115")',
             valueField: 'VALUE',
             textField: 'ITEM',
             columns: [[
                   { field: 'VALUE', title: '類別代碼', width: 60 },
                   { field: 'ITEM', title: '類別名稱', width: 180 },

             ]]
         });
     });

    function Initialize_DataGrid() {
        var getGridJSON = '@Url.Action("Grid", "Frm115")';
        $('#DataGrid').datagrid({
            title: '帳號權限維護',
            url: getGridJSON,
            width: '650',
            height: '400',
            rownumbers: true,
            nowrap: true,
            pagination: true,
            pageSize: 20,
            idField: 'UUID',
            striped: true,
            showHeader: true,
            fitColumns: true,
            remoteSort: true,
            singleSelect: true,
            sortName: 'USERID',
            sortOrder: 'asc',
            columns: [[
                {
                    field: 'USERID',
                    title: '帳號',
                    sortable: true,
                    width: 100,
                    halign: "center",
                    align: "center",
                    sortable: true
                },
                {
                    field: 'USERNAME',
                    title: '名稱',
                    sortable: true,
                    width: 120,
                    halign: "center",
                    align: "left",
                    sortable: true
                },
                {
                    field: 'ROLEID',
                    title: '角色',
                    sortable: true,
                    width: 100,
                    halign: "center",
                    align: "center",
                    formatter: function (value, row, iIndex) {
                        var valueStr = "";
                        if (value == "1") {
                            valueStr = "櫃檯人員";
                        } else if (value == "2") {
                            valueStr = "行政人員";
                        } else if (value == "3") {
                            valueStr = "俱樂部";
                        } else if (value == "9") {
                            valueStr = "系統管理員";
                        }
                        return valueStr;
                    }

                },
                {
                    field: 'PASSWORD',
                    title: '密碼',
                    sortable: true,
                    width: 100,
                    halign: "center",
                    align: "center",
                    sortable: true
                }
            ]],
            onSelect: function (rowIndex, rowData) {
                $('#USERID').val($.trim(rowData.USERID));
                $('#USERNAME').val($.trim(rowData.USERNAME));
                $('#PASSWORD').val($.trim(rowData.PASSWORD));
                $('#ROLEID').combobox('setValue', $.trim(rowData.ROLEID));                              
                $('#UUID').val($.trim(rowData.UUID));
            }
        });

    }



    //新增
    function doAdd() {
        doClear();
        if ($('#mode').val() == 'save') {
            $('#btnAdd').linkbutton({ text: '取消新增' });
            $('#mode').val('add');
            $('#USERID').attr('readonly', false);
        } else {
            $('#btnAdd').linkbutton({ text: '新增' });
            $('#mode').val('save');
            $('#USERID').attr('readonly', true);
        }
    }

    //儲存
    function doSave() {        
        var mode = $.trim($('#mode').val());

        var bResult = $('#editForm').form('validate');
        if (bResult) {
            $.ajax({
                url: '@Url.Action("Save", "Frm115")',
                type: "post",
                data: getObj(mode),
                dataType: "json",
                success: function (data, textStatus, jqXHR) {
                    if (data.status != '0') {
                        $('#btnAdd').linkbutton('enable');
                        $('#DataGrid').datagrid('reload');
                        $.messager.alert('系統訊息', '資料已儲存!', 'info');                        
                    } else {
                        $.messager.alert('系統訊息', data.message, 'error');
                    }
                    $('#mode').val('save');
                    $('#btnAdd').linkbutton({ text: '新增' });
                }
            });
        }
    }
    function doRemove() {
        var selectRow = $('#DataGrid').datagrid('getSelected');        
        if (selectRow != null) {
            var obj = {};
            obj.UUID = selectRow.UUID;
  
            $.messager.confirm('執行確認', '是否確認刪除帳號:' + selectRow.USERID + ' 此筆資料?', function (r) {
                if (r) {
                    $.ajax({
                        url: '@Url.Action("Remove", "Frm115")',
                        type: "post",
                        data: obj,
                        dataType: "json",
                        success: function (data, textStatus, jqXHR) {
                            if (data.status != '0') {
                                $.messager.alert('系統訊息', '資料已刪除!', 'info');
                                doClear();
                                $('#DataGrid').datagrid('reload');
                            } else {
                                $.messager.alert('系統訊息', data.message, 'error');
                            }

                        }
                    });
                }
            });
        } else {
            $.messager.alert('系統訊息', '您尚未選取資料', 'warning');
        }
    }

    function doClear() {
        $('#USERID').val('');
        $('#USERNAME').val('');
        $('#PASSWORD').val('');
        $('#UUID').val('');
    }

    function getObj(mode) {
        var obj = {};
        obj.USERID = $.trim($('#USERID').val());
        obj.USERNAME = $.trim($('#USERNAME').val());
        obj.PASSWORD = $.trim($('#PASSWORD').val());
        obj.ROLEID = $.trim($('#ROLEID').combobox('getValue'));
        obj.UUID= $.trim($('#UUID').val());
        obj.mode = mode;
        return obj;
    }
</script>
<h2>Frm115 帳號權限維護</h2>
<a id="btnReload" href="#" class="easyui-linkbutton" data-options="iconCls:'icon-reload'" onclick="Initialize_DataGrid()">重新顯示</a>
<a id="btnAdd" href="#" class="easyui-linkbutton" data-options="iconCls:'add-icon'" onclick="doAdd()">新增</a>
<a id="btnSave" href="#" class="easyui-linkbutton" data-options="iconCls:'save-icon'" onclick="doSave()">儲存</a>
<a id="btnRemove" href="#" class="easyui-linkbutton" data-options="iconCls:'icon-no'" onclick="doRemove()">刪除</a>
<form id="editForm" name="editForm" method="post">
    <input type="hidden" id="mode" name="mode" value="save" />
    <input type="hidden" id="UUID" name="UUID" value="UUID"/>
    帳號<input type="text" name="USERID" id="USERID" class="easyui-validatebox" style="width:80px" size="5" data-options="required:true" readonly /><br />
    名稱<input type="text" name="USERNAME" id="USERNAME" class="easyui-validatebox" style="width:300px" /><br />
    密碼<input type="text" name="PASSWORD" id="PASSWORD" class="easyui-validatebox" style="width:300px" /><br />
    角色<select id="ROLEID" class="easyui-combobox" name="ROLEID" data-options="editable:false" style="width:150px;">
    <option value="1">櫃檯人員</option>
    <option value="2">行政人員</option>
    <option value="3">俱樂部</option>
    <option value="9">系統管理員</option>
</select>  
    
</form>
<table id="DataGrid"></table>
