@{
    ViewBag.Title = "Frm113 幫傭資料維護";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<script type="text/javascript">
    $(document).ready(function () {
        //國籍
        $('#COUNTRY').combobox({
            url: '@Url.Action("getCOUNTRY", "Frm113")',
            valueField: 'CNO',
            textField: 'CNM'
        });

         Initialize_DataGrid();
     });

     function Initialize_DataGrid() {
         var getGridJSON = '@Url.Action("Grid", "Frm113")';
        $('#DataGrid').datagrid({
            title: '幫傭資料維護',
            url: getGridJSON,
            width: '650',
            height: '400',
            rownumbers: true,
            nowrap: true,
            pagination: true,
            pageSize: 20,
            idField: 'CNM',
            striped: true,
            showHeader: true,
            fitColumns: true,
            remoteSort: true,
            singleSelect: true,
            sortName: 'CNM',
            sortOrder: 'asc',
            columns: [[
                 { field: 'CNM', title: '幫傭姓名', width: 120, sortable: true },
                 { field: 'SEX', title: '性別', width: 50, sortable: true },
                 { field: 'COUNTRY', title: '國籍', width: 90, sortable: true },
                 { field: 'TEL1', title: '電話1', width: 90, sortable: true },
                 { field: 'TEL2', title: '電話2', width: 90, sortable: true },
                 { field: 'TEL3', title: '電話3', width: 90, sortable: true }
            ]],
            onSelect: function (rowIndex, rowData) {
                $('#TAGID').val($.trim(rowData.TAGID));
                $('#CNM').val($.trim(rowData.CNM));                
                $('#SEX').combobox('setValue', rowData.SEX);                
                $('#COUNTRY').combobox('setValue', rowData.COUNTRY)
                $('#TEL1').val($.trim(rowData.TEL1));
                $('#TEL2').val($.trim(rowData.TEL2));
                $('#TEL3').val($.trim(rowData.TEL3));
                $('#PID').val($.trim(rowData.PID));
                $('#WORKITEM').val($.trim(rowData.WORKITEM));
                $('#WORKWITH').val($.trim(rowData.WORKWITH));
                $('#WORKNOTE').val($.trim(rowData.WORKNOTE));
            }
        });

    }



    //新增
    function doAdd() {
        doClear();
        if ($('#mode').val() == 'save') {
            $('#btnAdd').linkbutton({ text: '取消新增' });
            $('#mode').val('add');            
        } else {
            $('#btnAdd').linkbutton({ text: '新增' });
            $('#mode').val('save');            
        }
    }

    //儲存
    function doSave() {
        
        var mode = $.trim($('#mode').val());

        var bResult = $('#editForm').form('validate');
        if (bResult) {
            $.ajax({
                url: '@Url.Action("Save", "Frm113")',
                type: "post",
                data: getObj(mode),
                dataType: "json",
                success: function (data, textStatus, jqXHR) {
                    if (data.status != '0') {
                        $('#btnAdd').linkbutton('enable');
                        $('#DataGrid').datagrid('reload');
                        $.messager.alert('系統訊息', '資料已儲存!', 'info');
                    } else {
                        $.messager.alert('系統訊息', data.message, 'error');
                    }
                    $('#mode').val('save');
                    $('#btnAdd').linkbutton({ text: '新增' });
                }
            });
        }
    }
    function doRemove() {
        var selectRow = $('#DataGrid').datagrid('getSelected');

        if (selectRow != null) {
            var obj = {};
            obj.TAGID = selectRow.TAGID;
            $.messager.confirm('執行確認', '是否確認刪除幫傭:' + $('#CNM').val() + ' 此筆資料?', function (r) {
                if (r) {
                    $.ajax({
                        url: '@Url.Action("Remove", "Frm113")',
                        type: "post",
                        data: obj,
                        dataType: "json",
                        success: function (data, textStatus, jqXHR) {
                            if (data.status != '0') {
                                $.messager.alert('系統訊息', '資料已刪除!', 'info');
                                doClear();
                                $('#DataGrid').datagrid('reload');
                            } else {
                                $.messager.alert('系統訊息', data.message, 'error');
                            }

                        }
                    });
                }
            });
        } else {
            $.messager.alert('系統訊息', '您尚未選取資料', 'warning');
        }
    }

    function doClear() {
        $('#TAGID').val('');
        $('#CNM').val('');
        $('#PID').val('');
        $('#TEL1').val('');
        $('#TEL2').val('');
        $('#TEL3').val('');
        $('#WORKITEM').val('');
        $('#WORKWITH').val('');
        $('#WORKNOTE').val('');

    }

    function getObj(mode) {
        var obj = {};
        obj.TAGID = $.trim($('#TAGID').val());
        obj.CNM = $('#CNM').val();
        obj.PID = $('#PID').val();
        obj.TEL1 = $('#TEL1').val();
        obj.TEL2 = $('#TEL2').val();
        obj.TEL3 = $('#TEL3').val();
        obj.SEX = $('#SEX').combobox('getValue');
        obj.COUNTRY = $('#COUNTRY').combobox('getValue');
        obj.WORKITEM = $('#WORKITEM').val();
        obj.WORKWITH = $('#WORKWITH').val();
        obj.WORKNOTE = $('#WORKNOTE').val();
        obj.mode = mode;
        console.info(obj);
        return obj;
    }
</script>
<h2>Frm113 幫傭資料維護</h2>
<a id="btnReload" href="#" class="easyui-linkbutton" data-options="iconCls:'icon-reload'" onclick="Initialize_DataGrid()">重新顯示</a>
<a id="btnAdd" href="#" class="easyui-linkbutton" data-options="iconCls:'add-icon'" onclick="doAdd()">新增</a>
<a id="btnSave" href="#" class="easyui-linkbutton" data-options="iconCls:'save-icon'" onclick="doSave()">儲存</a>
<a id="btnRemove" href="#" class="easyui-linkbutton" data-options="iconCls:'icon-no'" onclick="doRemove()">刪除</a>
<form id="editForm" name="editForm" method="post">
    <table width="894" border="0" cellpadding="2" cellspacing="2">
        <tr>
            <td width="371">
                <input type="hidden" id="mode" name="mode" value="save" />
                <input type="hidden" id="TAGID" name="TAGID"  />
                幫傭姓名
                <input type="text" name="CNM" id="CNM" class="easyui-validatebox" style="width:80px" size="5" data-options="required:true"  />
                性別
                <select id="SEX" class="easyui-combobox" name="SEX" data-options="editable:false" style="width:80px;">
                    <option>男</option>
                    <option>女</option>
                </select>
            </td>
            <td width="253">
                國籍 <input type="text" name="COUNTRY" id="COUNTRY" class="easyui-combobox" data-options="editable:false" style="width:150px" />
            </td>
            <td width="250">
                證號
                <input type="text" name="PID" id="PID" class="easyui-validatebox" style="width:150px" />
            </td>
        </tr>
        <tr>
            <td rowspan="5" valign="top"><table id="DataGrid"></table></td>
            <td>
                電話1
                <input type="text" name="TEL1" id="TEL1" class="easyui-validatebox" style="width:150px" />
            </td>
            <td>
                電話2
                <input type="text" name="TEL2" id="TEL2" class="easyui-validatebox" style="width:150px" />
            </td>
        </tr>
        <tr>
            <td>
                電話3
                <input type="text" name="TEL3" id="TEL3" class="easyui-validatebox" style="width:150px" />
            </td>
            <td>&nbsp;</td>
        </tr>
        <tr>
            <td colspan="2" valign="top">
                工作項目<br />
                <label>
                    <textarea id="WORKITEM" name="WORKITEM" cols="50" rows="4"></textarea>
                </label>
            </td>
        </tr>
        <tr>
            <td colspan="2">
                工作需求<br />
                <textarea id="WORKWITH" name="textarea2" cols="50" rows="4"></textarea>
            </td>
        </tr>
        <tr>
            <td colspan="2">
                工作評語<br />
                <textarea id="WORKNOTE" name="WORKNOTE" cols="50" rows="4"></textarea>
            </td>
        </tr>
    </table>
</form>

