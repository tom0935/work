@{
    ViewBag.Title = "Frm110 車位資料維護";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<script type="text/javascript">
     $(document).ready(function () {         
         Initialize_DataGrid();
         getCountView();
     });

     function Initialize_DataGrid() {
         var getGridJSON = '@Url.Action("Grid", "Frm110")';
        $('#DataGrid').datagrid({
            title: '車位資料維護',
            url: getGridJSON,
            width: '650',
            height: '400',
            rownumbers: true,
            nowrap: true,
            pagination: true,
            pageSize: 20,
            idField: 'CNO',
            striped: true,
            showHeader: true,
            fitColumns: true,
            remoteSort: true,
            singleSelect: true,
            sortName: 'CNO',
            sortOrder: 'asc',
            columns: [[
                {
                    field: 'CNO',
                    title: '車位編號',
                    sortable: true,
                    width: 80,
                    halign: "center",
                    align: "center",
                    sortable: true
                },
                {
                    field: 'LOCT',
                    title: '位置',
                    sortable: true,
                    width: 80,
                    halign: "center",
                    align: "center",
                    sortable: true
                },
                {
                    field: 'SZ',
                    title: '大小',
                    sortable: true,
                    width: 100,
                    halign: "center",
                    align: "center",
                    sortable: true
                },
                {
                    field: 'USEON',
                    title: '用途',
                    sortable: true,
                    width: 120,
                    halign: "center",
                    align: "center",
                    sortable: true
                },
                {
                    field: 'CNPNO',
                    title: '出租合約',
                    sortable: true,
                    width: 150,
                    halign: "center",
                    align: "left",
                    sortable: true
                },


            ]],
            onSelect: function (rowIndex, rowData) {
                $('#CNO').val($.trim(rowData.CNO));                
                $('#LOCT').combobox('setValue', $.trim(rowData.LOCT));
                $('#SZ').combobox('setValue', $.trim(rowData.SZ));
                $('#USEON').combobox('setValue', $.trim(rowData.USEON));
                $('#ONUSE').val($.trim(rowData.ASET));
                if (rowData.ONUSE == '1') {
                    $('input:radio[name=ONUSE]').get(0).checked = true;
                } else {
                    $('input:radio[name=ONUSE]').get(1).checked = true;
                }
            }
        });

    }

    function doQueryByStatus() {
        $('#DataGrid').datagrid({
            url: '@Url.Action("GridQuery", "Frm110")'
        });
    }


    function getCountView() {
        $.ajax({
            url: '@Url.Action("getCountView", "Frm110")',
            type: "post",            
            dataType: "json",
            success: function (data, textStatus, jqXHR) {
                if (data.status != '0') {
                    $('#TOT').html("總共車位: " +data.view[0].TOT);
                    $('#USETOT').html($.trim("尚有空位: " +data.view[0].USETOT));
                } else {
                    $.messager.alert('系統訊息', data.message, 'error');
                }

            }
        });

    }


    //新增
    function doAdd() {
        doClear();
        if ($('#mode').val() == 'save') {
            $('#btnAdd').linkbutton({ text: '取消新增' });
            $('#mode').val('add');
            $('#CNO').attr('readonly', false);
        } else {
            $('#btnAdd').linkbutton({ text: '新增' });
            $('#mode').val('save');
            $('#CNO').attr('readonly', true);
        }
    }

    //儲存
    function doSave() {        
        var mode = $.trim($('#mode').val());

        var bResult = $('#editForm').form('validate');
        if (bResult) {
            $.ajax({
                url: '@Url.Action("Save", "Frm110")',
                type: "post",
                data: getObj(mode),
                dataType: "json",
                success: function (data, textStatus, jqXHR) {
                    if (data.status != '0') {
                        $('#btnAdd').linkbutton('enable');
                        $('#DataGrid').datagrid('reload');
                        $.messager.alert('系統訊息', '資料已儲存!', 'info');                        
                    } else {
                        $.messager.alert('系統訊息', data.message, 'error');
                    }
                    $('#mode').val('save');
                    $('#btnAdd').linkbutton({ text: '新增' });
                }
            });
        }
    }
    function doRemove() {
        var selectRow = $('#DataGrid').datagrid('getSelected');        
        if (selectRow != null) {
            var obj = {};
            obj.CNO = selectRow.CNO;
            $.messager.confirm('執行確認', '是否確認刪除費用分類編號:' + obj.CNO + ' 此筆資料?', function (r) {
                if (r) {
                    $.ajax({
                        url: '@Url.Action("Remove", "Frm110")',
                        type: "post",
                        data: obj,
                        dataType: "json",
                        success: function (data, textStatus, jqXHR) {
                            if (data.status != '0') {
                                $.messager.alert('系統訊息', '資料已刪除!', 'info');
                                doClear();
                                $('#DataGrid').datagrid('reload');
                            } else {
                                $.messager.alert('系統訊息', data.message, 'error');
                            }

                        }
                    });
                }
            });
        } else {
            $.messager.alert('系統訊息', '您尚未選取資料', 'warning');
        }
    }

    function doClear() {
        $('#CNO').val('');              
    }

    function getObj(mode) {
        var obj = {};
        obj.CNO = $.trim($('#CNO').val());        
        obj.LOCT = $.trim($('#LOCT').combobox('getValue'));
        obj.SZ = $.trim($('#SZ').combobox('getValue'));
        obj.USEON = $.trim($('#USEON').combobox('getValue'));
        obj.ONUSE = $("input[name='ONUSE']:checked").val();
        obj.mode = mode;
        return obj;
    }
</script>
<h2>Frm110 車位資料維護</h2>
<a id="btnReload" href="#" class="easyui-linkbutton" data-options="iconCls:'icon-reload'" onclick="Initialize_DataGrid()">重新顯示</a>
<a id="btnAdd" href="#" class="easyui-linkbutton" data-options="iconCls:'add-icon'" onclick="doAdd()">新增</a>
<a id="btnSave" href="#" class="easyui-linkbutton" data-options="iconCls:'save-icon'" onclick="doSave()">儲存</a>
<a id="btnRemove" href="#" class="easyui-linkbutton" data-options="iconCls:'icon-no'" onclick="doRemove()">刪除</a>
<a id="btnQuery" href="#" class="easyui-linkbutton" data-options="iconCls:'icon-search'" onclick="doQueryByStatus()">住宅用車位空位查詢</a><br />
<br />
    <div id="TOT" style="font-weight: bold;"></div><div id="USETOT" style="color: #FF0000;font-weight: bold;"></div>
    
<form id="editForm" name="editForm" method="post">
    <input type="hidden" id="mode" name="mode" value="save" />
    <br />
    <table width="600" border="1">
        <tr>
            <td width="141">車位編號</td>
            <td width="162"><input type="text" name="CNO" id="CNO" class="easyui-validatebox" style="width:80px" size="5" data-options="required:true" readonly /></td>
            <td width="110">用途</td>
            <td width="159">
                <select id="USEON" name="USEON" class="easyui-combobox" data-options="editable:false" style="width:150px;">                    
                    <option value="臨停">臨停</option>
                    <option value="住宅">住宅</option>
                    <option value="行政">行政</option>
                </select>

            </td>
        </tr>
        <tr>
            <td>位置</td>
            <td>
                <select id="LOCT" name="LOCT" class="easyui-combobox" data-options="editable:false" style="width:150px;">
                    <option value="B1">B1</option>
                    <option value="B2">B2</option>
                    <option value="B3">B3</option>
                </select>
            </td>
            <td>使用狀態</td>
            <td>                
                    <input name="ONUSE" type="radio" value="1">
                    使用中                                
                    <input name="ONUSE" type="radio" value="0">
                    未使用
                    
</td>
        </tr>
        <tr>
            <td>大小</td>
            <td>
                <select id="SZ" name="SZ" class="easyui-combobox" data-options="editable:false" style="width:150px;">
                    <option value="單車位">單車位</option>
                    <option value="雙車位">雙車位</option>                    
                </select>
            </td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
        </tr>
    </table>
</form>
<br />
<table id="DataGrid"></table>
